a2zApp.controller('QueryController', function($scope, $http, ShoppingCartService) {

  // Listen to the 'userSearched' event generated by parent controller (index.js)
  $scope.$on('userSearched', function (event, data) {
    console.log('User Search event received: ' + data); 
    
    $scope.isShowingFeaturedProducts = (data == null || !(/\S/.test(data)));
    
    // TODO: make data url-friendly?
    var url = '/api/ProductQuery/' + data;
    
    $http.get(url)
    .then(function(okResponse) {
      $scope.products = okResponse.data;
      window.location = "#/home";
    }, function(errorResponse) {
      console.log("Error in " + url);
      console.log(errorResponse);
    });
  });

  $scope.addToCart = function(product) {
    ShoppingCartService.add(product);
    window.location = "#/shopping-cart";
  }

  $scope.isInCart = function(product) {
    return ShoppingCartService.isInCart(product);
  }

});
